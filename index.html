<!DOCTYPE html>
<html ng-app="demoapp">
  <head>
  
    <link rel="shortcut icon" href="/favicon.png" />

    <title>農學地圖 ➭ 上下游互助</title>

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!--    
   <meta property="fb:admins" content="100000207390400" />
   <meta property="fb:app_id" content="697252030337861" />  -->

    <meta property="og:site_name" content="農學互助支持網" />
    <meta property="og:description" content="農學地圖 ➭ 上下游互助" />
    <meta property="og:title" content="農學地圖 ➭ 上下游互助" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://g0v.github.io/farmer/index.html" />
    <meta property="og:image" content="http://g0v.github.io/farmer/img/main.jpg" />



  <link rel="stylesheet" href="module/src/bootstrap.css" />
  <link rel="stylesheet" href="module/src/bootstrap-theme.min.css" />
  <link rel="stylesheet" href="module/src/bootstrap-select.min.css" />   
  <link rel="stylesheet" href="module/shackhand-0.0.3.css" />


</head>

<body ng-controller="SKH-Ctrl">

  <!-- Facebook API  -->
<!--  <div id="fb-root"></div> -->



  <!-- Navbar -->

<div class="navbar navbar-default navbar-fixed-top" role="navigation">

    <div class="navbar-header pull-left">
              <div class="navbar-brand noPhone">
                  <h3 class= "h3"><a href = "https://hackpad.com/2.0-gZL8jQ3iwgI">農學地圖 ☯ 上下游互助</a>
                  </h3>
              </div>

          <div class = "navbar-left noPhone">              

              <a ng-show = "root.name"  ng-click = "focus(n)" style = "cursor:pointer">
                <img id = "fb" ng-src="http://graph.facebook.com/{{root.id || root.username}}/picture"/>
              </a>

          </div>

 <!--     <div class="navbar-left">
              <form class="navbar-form" role="search">

                 <skh-select></skh-select>

              </form>
          </div>  -->
    </div> 


    <div class="navbar-header pull-right">

        <skh-index indexurl = "https://mapindex.firebaseio.com/support/"></skh-index>

     </div>
</div>

  <!-- Navbar Bottom -->

<div class="navbar navbar-inverse navbar-fixed-bottom noPhone" role="navigation" >

    <div class="navbar-header pull-left">
          <div class = "navbar-left">
            <a href = "http://g0v.tw">
              <img src = "http://g0v.tw/imgs/g0v-horizontal-transparent-darkbackground-m.png">
            </a>
          </div>

          <div class = "navbar-left">
                <div class="collapse navbar-collapse">
                  後台共筆：
                  <ul class="nav navbar-nav">
                    <li><a href = "https://ethercalc.org/farmer" target = "_blank">友善農夫</a></li>
                    <li><a href = "https://ethercalc.org/farmerMarket" target = "_blank">農夫市集</a></li>
                    <li><a href = "https://ethercalc.org/farmerHandle" target = "_blank">友善加工</a></li>
                  </ul>
                </div>
          </div>
    </div> 

    <div class="navbar-header pull-right">
        <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li><a href="http://zh-tw.facebook.com/notes/%E7%9B%B4%E6%8E%A5%E8%B7%9F%E8%BE%B2%E5%A4%AB%E8%B2%B7/%E7%9B%B4%E6%8E%A5%E8%B7%9F%E8%BE%B2%E5%A4%AB%E8%B2%B7%E5%8F%B0%E7%81%A3%E5%90%84%E5%9C%B0%E8%BE%B2%E5%A4%AB%E5%B8%82%E9%9B%86/120928917954482" target = "_blank">資料來源：&lt;直接跟農夫買&gt;</a>
                  <li><a href = "mailto:bestian@gmail.com">打造您的專屬地圖，請洽bestian@gmail.com</a></li>
                </ul>
        </div>
     </div>
</div>

<div>
  <div class="container main-container">
<!--
    <div class="row">
       <div class = "col-md-12">
          <div class = "alert alert-info">
            <h3>                    
                    <a href = "https://ethercalc.org/farmer" target = "_blank">友善農夫</a> ➭
                    <a href = "https://ethercalc.org/farmerMarket" target = "_blank">農夫市集</a> ➭ 
                    <a href = "https://ethercalc.org/farmerHandle" target = "_blank">友善加工</a> ➭ 
                    <a href = "https://ethercalc.org/farmerRetail" target = "_blank">友善零售</a> ➭ 
                    <a href = "https://ethercalc.org/farmerMeal" target = "_blank">友善餐飲</a> ➭ <skh-fblogin></skh-fblogin>
             </h3>
          </div>
        </div>
        <skh-slogen></skh-slogen>

    </div> -->

   <!--
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <div class="well noPhone">

<a href="https://github.com/bestian/shackhand/"><img style="position: absolute; top: 0; right: 15px; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
       <div id = "J" class="join">

            
              <h3><span ng-bind = "(!imp && '升起您的農學互助支持旗') || '請填寫您升起的旗幟內容，再按「升起旗幟」'"></span>
                  <span ng-show = "!imp">，一起來友善大地！</span></h3>


            <img id = "fb" ng-show = "root.name" ng-src="http://graph.facebook.com/{{root.id || root.username}}/picture"/>

            <span ng-bind = "root.name" ng-show = "root.name"></span> 
            

            <skh-fblogin></skh-fblogin>
            <skh-fblogout></skh-fblogout>
 
            <button class= "btn btn-warning" onclick = "window.open('https://hackpad.com/2.0-gZL8jQ3iwgI')">使用說明</button>
 
            <hr>
-->

<!--main form -->

<!--
      <form ng-show = "root.name">


        <div class="input-group">
              <span class="input-group-addon">名字</span>
                <input class = "form-control" ng-model = "root.name" placeholder = "您的大名"/ >
        </div>
        <div class="input-group">            
              <span class="input-group-addon">概略地址</span>
                <input class = "form-control" ng-model = "root.address"/ ng-change = "checkLatLng(root.address,n)" placeholder = "地址愈詳細，別人愈好認識你的所在">
                  <span class="input-group-addon"
                    ng-show = "root.address && root.latlngColumn !== 'undefined,undefined'"
                      ng-bind = "root.latlngColumn"></span>
                    <span class="input-group-addon" ng-show = "root.address && root.latlngColumn == 'undefined,undefined'">
                      <button class = "btn btn info"ng-click = "checkLatLng(root.address,n)">定位!</button>
                    </span>
        </div>


        <div class="input-group">
              <span class="input-group-addon">個人網址</span>
                <input class = "form-control" ng-model = "root.site"
                  placeholder = "輸入網址讓人更認識你" />
                  <span class="input-group-addon" ng-show = "root.site">
                    <a href = "{{root.site | makeHref}}" target = "_blank">
                    <img ng-src = "http://www.google.com/s2/favicons?domain={{root.site}}">測試這個連結</a>
                  </span>
        </div>

        <div class="input-group">
              <span class="input-group-addon">社群網址</span>
                <input class = "form-control" ng-model = "root.site2"
               placeholder = "輸入網址以助人連結到社群" />
               
                  <span class="input-group-addon" ng-show = "root.site2">
                   <a ng-show = "root.site2" href = "{{root.site2 | makeHref }}" target = "_blank">
                    <img ng-src = "http://www.google.com/s2/favicons?domain={{root.site2}}">測試這個連結</a><br>
                  </span>
        </div>


        <div class="input-group">
              <span class="input-group-addon">比較有空的時段</span>
                <input type = "text" class = "form-control" ng-model = "root.freetime" rows = '5' cols = '30' placeholder = '例如：週五下午和週末' /><br>

        </div>
        <div class="input-group">
              <span class="input-group-addon">聯絡方式</span>
                <textarea class = "form-control" ng-model = "root.connect_me" rows = '5' cols = '30' placeholder = 'e-mail, 手機...可公開的聯絡方式(FB連絡有內建不用寫)'></textarea><br>
        </div>


        <div class="input-group">
              <span class="input-group-addon">您的身份</span>


              <select class = "form-control selectpicker" ng-model = "root.learner_role">
                  <option value =""> -- 選擇一種最接近你的農學身份 -- </option>
                  <option ng-repeat = "t in ['學生', '農夫', '假日農夫','友善加工業者', '友善餐飲界者','友善消費者']"
                      ng-selected = "root.learner_role == t" value="{{t}}">{{t}}</option>
              </select>
        </div>



        <div class="input-group">
              <span class="input-group-addon">主要的工作型態</span>
       
              <select class = "form-control selectpicker" ng-model = "root.learner_type">
                  <option value =""> -- 選擇一種工作型態 -- </option>
                  <option ng-repeat = "t in ['個人','三五好友','自組織團體','受雇於機構']"
                      ng-selected = "root.learner_type == t" value="{{t}}">{{t}}</option>
              </select>
        </div>


        <div class="input-group">
              <span class="input-group-addon">出生年次(自己)</span>

                      <input class = "form-control" ng-model = 'root.learner_birth' type = 'text' placeholder = '您自己的年次(西元)'></input>

        </div>

        <div class="input-group">
              <span class="input-group-addon">休閒作物</span>

            <textarea class = "form-control" ng-model = "root.plant" rows = '4' cols = '30' placeholder = '種開心的作物，或是加工製作的私房菜'/></textarea>

        </div>
            
        <div class="input-group">
              <span class="input-group-addon">經濟作物：</span>

            <textarea class = "form-control" ng-model = "root.crop" rows = '4' cols = '30' placeholder = '種出來有在賣的作物，或是加工製作來賣的食材或料理'/></textarea>
        </div>

        <div class="input-group">
              <span class="input-group-addon">個人興趣</span>
                <input class = "form-control" ng-model = "root.learner_habit" placeholder = '個人興趣'/>
        </div>
        
        <div class="input-group">

            <span class="input-group-addon">技術專長：</span>
              <textarea class = "form-control" ng-model = "root.skill" rows = '4' cols = '30'placeholder = '例如:自然農法、機械維修、資訊工程'/></textarea>

        </div>

        <div class="input-group">
              <span class="input-group-addon">可分享</span>
                <input class = "form-control" ng-model = "root.share" placeholder = '可提供他人的支持分享，請務必填寫'/>
        </div>
        
        <div class="input-group">
            <span class="input-group-addon">比較有空的時段：</span>
              <input class = "form-control" ng-model = "root.freetime"  placeholder = '例如：週五下午和週末'/>
        </div>
        <div class="input-group">

            <span class="input-group-addon">比較需要人手的時段：</span>
              <input class = "form-control" ng-model = "root.busytime" rows = '5' cols = '30' placeholder = '例如：七八月'/>
        </div> 

        <div class="input-group">
              <span class="input-group-addon">尋找</span>
                <input class = "form-control" ng-model = "root.ask" placeholder = '讓人知道可以協助你什麼?'/>
        </div>

        <div class="input-group">
              <span class="input-group-addon">自我介紹</span>
                  <textarea calss = "form-control" ng-model = "root.note" rows = '5' cols = '30' placeholder = "請自由發揮，介紹自己"></textarea>

        </div>

        <div class="input-group">
              <span class="input-group-addon">
              <input type = "checkbox" ng-model ="readNote" >
                 我已閱讀過<a href = "https://hackpad.com/1SMZsYTVlq3" target= "_blank">使用說明</a></span>

        </div>

            <hr>

        <div class="btn-group" ng-show ="readNote">
              <button class = "btn btn-success" ng-hide = "imp" ng-click = "submit({'zh-tw':'登入', en: 'join'})">升起旗幟!!</button>
              <button class = "btn btn-success" ng-show = "imp" ng-click = "submit({'zh-tw':'更新', en:'update'})">更新旗幟!!</button>
              <button class = "btn btn-default" ng-show = "imp" ng-click = "out()">移除旗幟</button>
        </div>

              </form>


              <span ng-hide = "root.name">
                <span ng-bind = "status">此瀏覽器不支援，請試試看用不同的瀏覽器</span>

                  <br>
         <input type = "number" ng-model = "total"  ng-show = "n > 0">

                  <br> 
                  <span ng-repeat = "k in [3,2,1]" ng-show = "total - k >= 0">

                      <a ng-click = "focus(bases[0].hands[total - k])" style = "cursor:pointer" title="{{bases[0].hands[total - k].name}}">

                      <img
                      id = "{{ bases[0].hands[total - k].id && 'fb' }}"
                      title = "{{bases[0].hands[total - k].name }}"
                      ng-src="{{(bases[0].hands[total - k].id && 'http://graph.facebook.com/' + bases[0].hands[total - k].id + '/picture') || 'img/marker-icon.png'}}"/>

                      <span ng-bind = "'第'+ (total - k + 1) + '位支持者：' + (bases[0].hands[total - k].name) + '(' + bases[0].hands[total - k].address.substr(0,2) + ')'"></span>

                      </a>

                      <br> 
                  </span>
              </span>

              <span ng-show = "n > 0">
                <hr>
                您是第<span ng-bind = "n + 1"></span>位支持者嗎？<skh-fblogin></skh-fblogin>
              </span>
          </div>
        </div>        
      </div>

-->
      
        <div class="row">
     <!--         <button class="btn btn-info" ng-click="goFullscreen()" style="float:left">全螢幕</button> -->
    <!--      <skh-eaglemap></skh-eaglemap> -->
              <skh-localmap></skh-localmap>
        </div>

       </div>

      </div>

  </div>

</body>
</html>


    <script src="module/src/jquery-1.10.2.js"></script>
    <script src="module/src/angular.min.js"></script>
    <script src="module/src/angular-route.min.js"></script>
    <script src="module/src/angular-fullscreen.js"></script>

    <script src="module/src/leaflet-0.7.1.js"></script>
    <script src="module/src/angular-leaflet-directive.js"></script>
    <script src="module/src/leaflet.markercluster.js"></script>

    <link rel="stylesheet" href="module/src/leaflet.css" />    
    <link rel="stylesheet" href="module/src/leaflet.ie.css" /> 

    <link rel="stylesheet" href="module/src/leaflet.label.css" />    
    <script src="module/src/leaflet.label.js"></script>


<script src='module/src/firebase.js'></script>
<script src='module/src/angularfire.min.js'></script>
<script src='module/src/firebase-simple-login.js'></script>
<script src="module/src/angular-easyfb.min.js"></script>

<script src='module/shackhand-0.0.3.js'></script>



 
    <script>     

     function toLabel (hand, i, Icon, year, whichLable) {
        if (!whichLable) return hand.name;

        var label = " ";
        
        var simpleList = ['freetime','busytime','learner_type','learner_habit','skill','crop','connect_me','plant','share','ask'];

        for (var i = 0; i < simpleList.length; i++) {
          var k = simpleList[i];
          if (whichLable == k) label += ((SKH.has(hand[k]) && hand[k]) || "");
        };

        if (whichLable == 'age') label += (SKH.has(hand.learner_birth) && SKH.toAge(hand.learner_birth)+'歲' || '');
                     
        if (!label) label = ' ';   
        return label;

     }

     

     var toFlag = function(hand, i, Icon, from) {
          return '<div class="flag">'
                        + ((hand.id && '<a href = "http://www.facebook.com/'+hand.id+'" target = "_blank"> <img id = "fb" src="'+ Icon +'" />' ) || '')

                        +((!hand.username && hand.id && '<a href = "https://www.facebook.com/profile.php?id='+hand.id+'" target = "_blank"><img id = "fb" src="'+ Icon +'" />' ) || '')

                        +'<strong>第'+ (i+1) +'位關心農業的朋友'
                        +((from && from + '推薦的朋友') || '')
                        +'：'+ hand.name+'</strong></a><br />'

                        +((from && '大約') || '')
                        +(SKH.has(hand.learner_birth) && SKH.toAge(hand.learner_birth)+'歲的' || '')
                        +hand.learner_role
                        +((SKH.has(hand.learner_type) && '('+hand.learner_type+')') || '')
                  

                        +'<br>&nbsp;&nbsp;&nbsp;&nbsp;住在&nbsp;&nbsp;'+
                        '<a href = "https://maps.google.com.tw/maps?hl=zh-TW&q='
                        +hand.address+'" target = "_blank">'+hand.address+'</a>&nbsp;&nbsp;附近<hr>'

                        +((hand.site && '<b>個人網站: </b><a href = "'+SKH.toHref(hand.site)+'" target = "_blank">'
                          + '<img title = "' + hand.site
                              +'"src = "http://www.google.com/s2/favicons?domain=' + hand.site +'">'
                          + '</a>') || "")
                          
                        +((hand.site2 && '<b>社群網站: </b><a href = "'+SKH.toHref(hand.site2)+'" target = "_blank">'
                          + '<img title = "' + hand.site2 
                              + '" src = "http://www.google.com/s2/favicons?domain=' + hand.site2 +'">'
                          + '</a>') || "")
                        
                        +'<b>比較有空的時段：</b>'+( hand.freetime || "")+'<br />'
                        +'<b>較需人手的時段：</b>'+( hand.buzytime || "")+'<br />'
                        +'<b>聯絡方式：</b>'+( hand.connect_me || "")+'<br />'
                        +'<a href="https://www.facebook.com/messages/' + hand.id + 'target="_blank">FB訊息</a><br/>'
                        +'<hr>'
                        +'<b>興趣包含：</b>'+( hand.learner_habit || "")+'<br />'
                        +'<b>休閒作物：</b>'+( hand.plant || "")+'<br />'
                        +'<b>經濟作物：</b>'+( hand.crop || "")+'<br />'
                        +'<b>技術：</b>'+( hand.skill || "")+'<br />'
                        +'<b>可分享：</b>'+( hand.share || "")+'<br />'
                        +'<b>邀請連絡：</b>'+( hand.ask || "")+'<br />'
                        +'<hr>'
                        +'<b>自我介紹：</b>'+( hand.note.replace(/\n/g, '<br>')|| "")+'<br />'
                        +'<hr>'
                        +'</div>';
     }

     SKH.init({
     //   fbApp: '485195848253155',
     //   slogen: '友善土地 ☯ ︎友善農夫 ☯ ︎友善加工 ☯ ︎友善小店 ☯ ︎友善市集 ☯ ︎友善餐飲 ☯ ︎友善生活',
        selectBar: 
'<input autofocus type="search" class="form-control noPhone" placeholder="您在哪兒呢?"ng-model="loc" ng-change = "askGeo(loc)"/>'
+'<input type="search" class="form-control noPhone" placeholder="輸入關鍵字" ng-model="key" ng-change = "clearMarker(); makeMarkers()"/>'

        +'<select class = "form-control"'
                    +'ng-model="whichLable" ng-change = "clearMarker(); makeMarkers()">'
                      +'<option value="">-- 選擇顯示標籤 --</option>'
                //      +'<option value="age">年齡</option>'
                      +'<option value="freetime">時間</option>'
                      +'<option value="busytime">農忙時間</option>'
                      +'<option value="connect_me">聯絡方式</option>'
                      +'<option value="crop">農產品</option>'
                //      +'<option value="plant">休閒作物</option>'
                //      +'<option value="share">分享</option>'
                //      +'<option value="ask">需要</option>'
                  +'</select>',
     //   checkList: [[]],
    //    whiteList: ['site2','connect_me','skill','ask','username','crop','plant'],

/*  */
        headers: [{n: 'connect_me', t:'聯絡方式'},{n: 'crop', t: '農產品'}],
        layers: ['友善農夫','農夫市集','友善加工'],
        //'農學朋友', '友善零售','友善餐飲'],
        types: ['hackmap', 'hackmap', 'hackmap'],
        // 'firebase',
        urls: [
        //'https://shackhand-farmer.firebaseio.com/'
               'https://ethercalc.org/farmer',
               'https://ethercalc.org/farmerMarket',
               'https://ethercalc.org/farmerHandle'],
           //    'https://ethercalc.org/farmerRetail',
           //    'https://ethercalc.org/farmerMeal',],
        logins: [],
        toFlags: [toFlag],
        toLabels: [toLabel],

/*  */

   //     handTitle: '農學朋友',
  //      shackTitle: '農夫市集',
  //      firebase: 'https://shackhand-farmer.firebaseio.com/',
  //      hackmap: "https://ethercalc.org/farmerMarket",
           //https://ethercalc.org/farmerHandle
          // https://ethercalc.org/farmer

  //      toFlag: toFlag,
  //      toLabel: toLabel,


        lang:'zh-tw',
        listKeys: ['name','note','address','share','ask'], //'connect_me',
        listKeyNames: {
          name: '名稱',
          address:  '位於',
          share: '分享',
          ask: '尋找',
          note: '自我介紹'          
        }
     });        

        var app = angular.module('demoapp', ['firebase','ezfb','shackhand']);  //


    </script>

